#!/usr/bin/env sh

installdir=$1
if test -z ${installdir}; then
    installdir="${HOME}/.sbt"
fi

installdir=`readlink -f ${installdir}`

if test -d "$installdir"; then
    echo "${installdir} already exists." >&2
    exit 1
fi

sbtdir="${installdir}/bin"
install -d "${sbtdir}"
if ! test -d "$sbtdir"; then
    echo "${sbtdir} does not exists." >&2
    exit 1
fi

cd ${sbtdir}

# bin/sbt-launch.jar
echo "Downloading sbt-lanch.jar ...."
curl -LO "http://repo.typesafe.com/typesafe/ivy-releases/org.scala-sbt/sbt-launch/0.12.3/sbt-launch.jar"

# bin/sbt 
echo '#/usr/bin/env sh

java -Xms512M -Xmx1536M -Xss1M -XX:+CMSClassUnloadingEnabled -XX:MaxPermSize=384M -jar `dirname $0`/sbt-launch.jar "$@"' > sbt
chmod 775 sbt

# Complete messages 
echo ""
echo "sbt/sbt-launch.jar has been installed at ${sbtdir}."
echo "Don't forget to add to your environment variable PATH."
echo ""
echo "    % echo 'export PATH=${sbtdir}:\$PATH;' > ~/.bash_profile"
echo "    % . ~/.bash_profile"
echo ""
